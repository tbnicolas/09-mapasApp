import { AfterViewInit, Component, ElementRef, OnInit, ViewChild } from '@angular/core';
import * as mapboxgl from 'mapbox-gl';
import * as L from 'leaflet';
import * as MapboxDraw from '@mapbox/mapbox-gl-draw';
import { Feature, FeatureCollection } from 'geojson';


@Component({
  selector: 'app-polygono',
  templateUrl: './polygono.component.html',
  styles: [
    `
      .mapa-container{
        width: 100%;
        height: 100%;
      },


    `
  ]
})
export class PolygonoComponent implements OnInit, AfterViewInit {

  @ViewChild('mapa') divMapa!: ElementRef;

  mapa!: mapboxgl.Map;

  zoomLevel: number = 2;
  //center: [number, number] = [79.30961608886719, 61.57192958204744];
  //center: [number, number] = [-74.82056636251767,11.008696960530235 ];
  center: [number, number] = [-74.82270680487927,11.009282801052073 ];

  constructor() { }

  ngOnInit(): void {
  }

  ngAfterViewInit(): void {
    var Draw = new MapboxDraw({
      userProperties: true,
      displayControlsDefault: false,
      styles: [
        {
          'id': 'gl-draw-polygon-fill-inactive',
          'type': 'fill',
          'filter': ['all', ['==', 'active', 'false'],
            ['==', '$type', 'Polygon'],
            ['!=', 'mode', 'static']
          ],
          'paint': {
            'fill-color': [
              "case", ['==', ['get', "user_class_id"], 1], "#CC00FF", ['==', ['get', "user_class_id"], 2], "#FF009D",
              '#ff0000'
            ],
            'fill-outline-color': '#3bb2d0',
            'fill-opacity': 0.5
          }
        },
        /* {
          'id': 'gl-draw-polygon-fill-active',
          'type': 'fill',
          'filter': ['all', ['==', 'active', 'true'],
            ['==', '$type', 'Polygon']
          ],
          'paint': {
            'fill-color': '#fbb03b',
            'fill-outline-color': '#fbb03b',
            'fill-opacity': 0.1
          }
        },
        {
          'id': 'gl-draw-polygon-midpoint',
          'type': 'circle',
          'filter': ['all', ['==', '$type', 'Point'],
            ['==', 'meta', 'midpoint']
          ],
          'paint': {
            'circle-radius': 3,
            'circle-color': '#fbb03b'
          }
        },
        {
          'id': 'gl-draw-polygon-stroke-inactive',
          'type': 'line',
          'filter': ['all', ['==', 'active', 'false'],
            ['==', '$type', 'Polygon'],
            ['!=', 'mode', 'static']
          ],
          'layout': {
            'line-cap': 'round',
            'line-join': 'round'
          },
          'paint': {
            'line-color': '#3bb2d0',
            'line-width': 2
          }
        },
        {
          'id': 'gl-draw-polygon-stroke-active',
          'type': 'line',
          'filter': ['all', ['==', 'active', 'true'],
            ['==', '$type', 'Polygon']
          ],
          'layout': {
            'line-cap': 'round',
            'line-join': 'round'
          },
          'paint': {
            'line-color': '#fbb03b',
            'line-dasharray': [0.2, 2],
            'line-width': 2
          }
        },
        {
          'id': 'gl-draw-line-inactive',
          'type': 'line',
          'filter': ['all', ['==', 'active', 'false'],
            ['==', '$type', 'LineString'],
            ['!=', 'mode', 'static']
          ],
          'layout': {
            'line-cap': 'round',
            'line-join': 'round'
          },
          'paint': {
            'line-color': '#3bb2d0',
            'line-width': 2
          }
        },
        {
          'id': 'gl-draw-line-active',
          'type': 'line',
          'filter': ['all', ['==', '$type', 'LineString'],
            ['==', 'active', 'true']
          ],
          'layout': {
            'line-cap': 'round',
            'line-join': 'round'
          },
          'paint': {
            'line-color': '#fbb03b',
            'line-dasharray': [0.2, 2],
            'line-width': 2
          }
        },
        {
          'id': 'gl-draw-polygon-and-line-vertex-stroke-inactive',
          'type': 'circle',
          'filter': ['all', ['==', 'meta', 'vertex'],
            ['==', '$type', 'Point'],
            ['!=', 'mode', 'static']
          ],
          'paint': {
            'circle-radius': 5,
            'circle-color': '#fff'
          }
        },
        {
          'id': 'gl-draw-polygon-and-line-vertex-inactive',
          'type': 'circle',
          'filter': ['all', ['==', 'meta', 'vertex'],
            ['==', '$type', 'Point'],
            ['!=', 'mode', 'static']
          ],
          'paint': {
            'circle-radius': 3,
            'circle-color': '#fbb03b'
          }
        },
        {
          'id': 'gl-draw-point-point-stroke-inactive',
          'type': 'circle',
          'filter': ['all', ['==', 'active', 'false'],
            ['==', '$type', 'Point'],
            ['==', 'meta', 'feature'],
            ['!=', 'mode', 'static']
          ],
          'paint': {
            'circle-radius': 5,
            'circle-opacity': 1,
            'circle-color': '#fff'
          }
        },
        {
          'id': 'gl-draw-point-inactive',
          'type': 'circle',
          'filter': ['all', ['==', 'active', 'false'],
            ['==', '$type', 'Point'],
            ['==', 'meta', 'feature'],
            ['!=', 'mode', 'static']
          ],
          'paint': {
            'circle-radius': 3,
            'circle-color': '#3bb2d0'
          }
        },
        {
          'id': 'gl-draw-point-stroke-active',
          'type': 'circle',
          'filter': ['all', ['==', '$type', 'Point'],
            ['==', 'active', 'true'],
            ['!=', 'meta', 'midpoint']
          ],
          'paint': {
            'circle-radius': 7,
            'circle-color': '#fff'
          }
        },
        {
          'id': 'gl-draw-point-active',
          'type': 'circle',
          'filter': ['all', ['==', '$type', 'Point'],
            ['!=', 'meta', 'midpoint'],
            ['==', 'active', 'true']
          ],
          'paint': {
            'circle-radius': 5,
            'circle-color': '#fbb03b'
          }
        },
        {
          'id': 'gl-draw-polygon-fill-static',
          'type': 'fill',
          'filter': ['all', ['==', 'mode', 'static'],
            ['==', '$type', 'Polygon']
          ],
          'paint': {
            'fill-color': '#404040',
            'fill-outline-color': '#404040',
            'fill-opacity': 0.1
          }
        },
        {
          'id': 'gl-draw-polygon-stroke-static',
          'type': 'line',
          'filter': ['all', ['==', 'mode', 'static'],
            ['==', '$type', 'Polygon']
          ],
          'layout': {
            'line-cap': 'round',
            'line-join': 'round'
          },
          'paint': {
            'line-color': '#404040',
            'line-width': 2
          }
        },
        {
          'id': 'gl-draw-line-static',
          'type': 'line',
          'filter': ['all', ['==', 'mode', 'static'],
            ['==', '$type', 'LineString']
          ],
          'layout': {
            'line-cap': 'round',
            'line-join': 'round'
          },
          'paint': {
            'line-color': '#404040',
            'line-width': 2
          }
        },
        {
          'id': 'gl-draw-point-static',
          'type': 'circle',
          'filter': ['all', ['==', 'mode', 'static'],
            ['==', '$type', 'Point']
          ],
          'paint': {
            'circle-radius': 5,
            'circle-color': 'pink'
          }
        } */
      ]
    });

    const geojsonFeature: Feature  = {
      'type': 'Feature' as const,
      properties: {
        name: 'Coors Field',
        amenity: 'Baseball Stadium',
        popupContent: 'This is where the Rockies play!'
      },
      'geometry': {

        'type': 'Polygon' as const,
        'coordinates': [

          [


            [-67.13734, 45.13745],
            [-66.96466, 44.8097],
            [-68.03252, 44.3252],
            [-69.06, 43.98],
            [-70.11617, 43.68405],
            [-70.64573, 43.09008],
            [-70.75102, 43.08003],
            [-70.79761, 43.21973],
            [-70.98176, 43.36789],
            [-70.94416, 43.46633],
            [-71.08482, 45.30524],
            [-70.66002, 45.46022],
            [-70.30495, 45.91479],
            [-70.00014, 46.69317],
            [-69.23708, 47.44777],
            [-68.90478, 47.18479],
            [-68.2343, 47.35462],
            [-67.79035, 47.06624],
            [-67.79141, 45.70258],
            [-67.13734, 45.13745]

          ]


        ]
      }
    }

    this.mapa = new mapboxgl.Map({
      container: this.divMapa.nativeElement,
      style: 'mapbox://styles/mapbox/streets-v11',
      center:this.center,
      zoom: this.zoomLevel
    });
    this.mapa.addControl(Draw, undefined);

    /* L.geoJSON(geojsonFeature).addTo(this.mapa as any);

    let me = this;
    me.space = this.space; */
    var geoJsonPolygonListBarranquilla: FeatureCollection = {
      type:'FeatureCollection',
      features: [
        {
          type:'Feature',
          properties: {
            "class_id":1
          },
          geometry:{
            type: 'Polygon',
            coordinates: [
              [

                [-160.9771,17.8386],
                [-160.9769,17.8447],
                [-161.0168,19.0931],
                [-160.6647,19.6790],
                [-160.2737,20.3358],
                [-160.1117,20.4588],
                [-159.4722,20.8748],
                [-158.8416,21.3114],
                [-158.1514,21.4904],
                [-157.3995,21.3871],
                [-156.6156,21.1018],
                [-155.8488,20.8414],
                [-155.2102,21.1540],
                [-155.1787,21.4541],
                [-154.7119,22.1232],
                [-154.2754,22.7152],
                [-154.1486,22.7760],
                [-153.4728,22.8921],
                [-152.7971,22.9899],
                [-152.1367,23.1460],
                [-151.5262,23.5462],
                [-151.2954,23.9323],
                [-150.9787,24.2689],
                [-150.3873,24.7674],
                [-149.7228,24.8800],
                [-148.9591,24.4185],
                [-148.4830,23.8593],
                [-148.4342,22.5613],
                [-148.6013,22.2410],
                [-149.1345,21.4061],
                [-149.2463,21.3005],
                [-149.7491,21.1006],
                [-150.3888,20.9441],
                [-151.0176,20.7060],
                [-151.6003,20.1797],
                [-151.7034,20.0929],
                [-152.2253,19.8996],
                [-152.8703,19.7232],
                [-153.5338,19.6339],
                [-154.2256,19.6758],
                [-154.8883,19.5332],
                [-155.0684,18.9230],
                [-155.3985,18.5594],
                [-155.9355,17.7051],
                [-155.9386,17.7019],
                [-156.5845,17.4527],
                [-157.2626,17.3359],
                [-157.9662,17.3242],
                [-158.6747,17.3032],
                [-159.3789,17.2272],
                [-160.1225,17.3070],
                [-160.9751,17.8368],
                [-160.9771,17.8386]

                /* [-74.82380382834627, 11.008966859331103],
                [-74.8231037718186, 11.01046231382585],
                [-74.82104383535307,11.009632969398739],
                [-74.82213281217183,11.008129612125009],
                [-74.82380382834627, 11.008966859331103] */


              ]
            ]
          },


        } ,
        {

            type:'Feature',
            properties: {},
            geometry: {
              type:'Polygon',
              coordinates: [
                [
                  /* [-74.82516102603488,11.009736966684713],
                  [-74.82362680253651,11.011140268242709],
                  [-74.82381992157826,11.00896027720656],
                  [-74.82516102603488,11.009736966684713] */

                  [-61.9397,27.5739],
                  [-65.3140,27.1147],
                  [-68.2320,26.6519],
                  [-70.7302,26.1951],
                  [-72.9397,25.7454],
                  [-73.0578,25.7222],
                  [-74.7924,25.4554],
                  [-76.4855,25.1949],
                  [-78.0666,24.9421],
                  [-79.5568,24.6929],
                  [-80.9675,24.4500],
                  [-82.3033,24.2226],
                  [-83.5740,24.0107],
                  [-84.7748,23.8362],
                  [-85.9094,23.7072],
                  [-86.9782,23.6375],
                  [-88.0099,23.5841],
                  [-89.0039,23.5554],
                  [-89.9549,23.5698],
                  [-90.8499,23.6645],
                  [-91.6956,23.8347],
                  [-92.5173,24.0302],
                  [-93.3406,24.1941],
                  [-94.1803,24.2897],
                  [-95.0427,24.2975],
                  [-95.9184,24.2348],
                  [-96.7888,24.1470],
                  [-97.6432,24.0634],
                  [-98.4817,23.9869],
                  [-99.2982,23.9388],
                  [-100.0915,23.9286],
                  [-100.8621,23.9604],
                  [-101.6040,24.0596],
                  [-102.1324,24.2078],
                  [-102.3143,24.2434],
                  [-103.0190,24.4281],
                  [-103.7077,24.6524],
                  [-104.3853,24.9022],
                  [-105.0434,25.2105],
                  [-105.3725,25.4202],
                  [-105.6843,25.5733],
                  [-106.3561,25.8110],
                  [-107.0429,25.9788],
                  [-107.7351,26.1107],
                  [-108.4262,26.2317],
                  [-109.1027,26.3993],
                  [-109.5726,26.6249],
                  [-109.7553,26.6594],
                  [-110.4266,26.8294],
                  [-111.0786,27.0776],
                  [-111.7196,27.3726],
                  [-112.3556,27.6895],
                  [-112.7588,27.8937],
                  [-112.9938,27.9952],
                  [-113.6444,28.2384],
                  [-114.3049,28.4268],
                  [-114.9752,28.5563],
                  [-115.6551,28.6216],
                  [-116.3426,28.6276],
                  [-117.0369,28.5703],
                  [-117.7323,28.4785],
                  [-118.4258,28.3697],
                  [-119.1145,28.2634],
                  [-119.7971,28.1720],
                  [-120.4703,28.1306],
                  [-121.1321,28.1690],
                  [-121.7865,28.2679],
                  [-122.4357,28.4171],
                  [-123.0841,28.5804],
                  [-123.7339,28.7348],
                  [-124.3878,28.8457],
                  [-125.0442,28.9208],
                  [-125.7022,28.9698],
                  [-126.2620,29.0251],
                  [-126.3585,29.0441],
                  [-127.0112,29.2055],
                  [-127.6646,29.3893],
                  [-128.3220,29.5122],
                  [-128.9831,29.5242],
                  [-129.6471,29.3212],
                  [-130.0887,29.0074],
                  [-130.3093,28.8905],
                  [-130.9650,28.5029],
                  [-131.6161,28.2408],
                  [-132.2686,28.3096],
                  [-132.9320,28.8097],
                  [-133.0906,29.0109],
                  [-133.4107,30.4189],
                  [-133.4280,31.8575],
                  [-133.6147,33.3323],
                  [-133.7607,33.8629],
                  [-133.9694,34.8474],
                  [-134.3969,36.4074],
                  [-134.6464,37.4162],
                  [-134.7773,38.0168],
                  [-134.9049,39.6800],
                  [-134.8116,40.1107],
                  [-134.4018,41.4009],
                  [-134.1344,41.7721],
                  [-133.3826,42.6306],
                  [-132.7723,43.1882],
                  [-132.6025,43.3169],
                  [-131.8012,43.8940],
                  [-130.9826,44.5779],
                  [-130.5130,45.0660],
                  [-130.1368,45.6112],
                  [-129.2496,46.7979],
                  [-129.0679,47.0519],
                  [-129.2036,48.0905],
                  [-130.0786,49.0802],
                  [-130.1606,49.1492],
                  [-130.9915,49.4631],
                  [-131.9263,50.0915],
                  [-132.8968,50.8801],
                  [-133.6306,51.4064],
                  [-133.9085,51.7089],
                  [-134.9959,52.8474],
                  [-135.9461,53.8656],
                  [-136.2137,54.4285],
                  [-137.1568,56.5618],
                  [-137.6290,59.5821],
                  [-137.3380,60.7819],
                  [-136.6110,63.0755],
                  [-136.5282,63.1712],
                  [-135.3403,64.3120],
                  [-134.0350,65.3702],
                  [-132.6064,66.3104],
                  [-131.0588,66.9692],
                  [-129.4740,67.4253],
                  [-129.4325,67.4334],
                  [-127.7694,67.6629],
                  [-126.1018,67.7396],
                  [-124.4538,67.6931],
                  [-122.8308,67.5803],
                  [-122.6878,67.5612],
                  [-121.3238,67.2189],
                  [-119.9691,66.6232],
                  [-118.8154,65.7536],
                  [-117.8325,64.7002],
                  [-116.9219,63.6465],
                  [-116.7087,63.3831],
                  [-116.2002,62.3627],
                  [-115.5899,60.9776],
                  [-115.2457,59.9179],
                  [-115.2118,59.2383],
                  [-115.1478,56.9128],
                  [-115.1469,56.8925],
                  [-114.9588,54.8517],
                  [-114.7269,54.2202],
                  [-114.3248,53.8258],
                  [-113.6011,53.0551],
                  [-112.9227,52.2338],
                  [-112.6917,51.8700],
                  [-112.2315,51.4837],
                  [-111.4637,50.9302],
                  [-110.6305,50.5350],
                  [-109.7311,50.2833],
                  [-108.7833,50.1257],
                  [-107.7912,50.0425],
                  [-106.7713,49.9953],
                  [-105.6678,50.0671],
                  [-104.4031,50.3533],
                  [-102.8214,51.0233],
                  [-100.8701,52.0386],
                  [-99.4697,52.7691],
                  [-99.1820,53.9368],
                  [-98.7928,55.3246],
                  [-94.5269,58.1013],
                  [-93.4194,58.6106],
                  [-91.6052,59.0520],
                  [-89.4156,59.3713],
                  [-87.2690,59.5894],
                  [-85.2741,59.6651],
                  [-84.3032,59.6516],
                  [-83.7463,59.4693],
                  [-82.1065,59.3071],
                  [-79.8067,59.4026],
                  [-79.6168,59.4156],
                  [-78.3430,58.4374],
                  [-77.1133,57.4082],
                  [-75.9647,56.3632],
                  [-74.8909,55.3039],
                  [-73.8864,54.2316],
                  [-72.9459,53.1474],
                  [-72.0646,52.0523],
                  [-71.2380,50.9473],
                  [-70.4624,49.8333],
                  [-69.7338,48.7109],
                  [-69.0492,47.5808],
                  [-68.4052,46.4438],
                  [-67.7993,45.3002],
                  [-67.2288,44.1507],
                  [-66.6914,42.9957],
                  [-66.1850,41.8356],
                  [-65.7075,40.6708],
                  [-65.2573,39.5016],
                  [-64.8327,38.3283],
                  [-64.4322,37.1513],
                  [-64.0544,35.9708],
                  [-63.6980,34.7871],
                  [-63.3618,33.6004],
                  [-63.0449,32.4108],
                  [-62.7461,31.2187],
                  [-62.4647,30.0241],
                  [-62.1997,28.8273],
                  [-61.9503,27.6284],
                  [-61.9397,27.5739],

                ]
              ]
            }

        }
      ]
    }
    var geoJSON: FeatureCollection = {
      "type": "FeatureCollection",
      "features": [{
          "type": "Feature",
          "properties": {
            "class_id": 1
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  79.30961608886719,
                  61.57192958204744
                ],
                [
                  79.34309005737303,
                  61.57192958204744
                ],
                [
                  79.34309005737303,
                  61.57871162332267
                ],
                [
                  79.30961608886719,
                  61.57871162332267
                ],
                [
                  79.30961608886719,
                  61.57192958204744
                ]
              ]
            ]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "class_id": 2
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  79.35201644897461,
                  61.58271478278019
                ],
                [
                  79.35115814208984,
                  61.573972521656835
                ],
                [
                  79.38188552856444,
                  61.57192958204744
                ],
                [
                  79.3956184387207,
                  61.581080902573085
                ],
                [
                  79.37124252319336,
                  61.58973948654749
                ],
                [
                  79.35201644897461,
                  61.58271478278019
                ]
              ]
            ]
          }
        },
        {
          "type": "Feature",
          "properties": {
            "class_id": 2
          },
          "geometry": {
            "type": "Polygon",
            "coordinates": [
              [
                [
                  79.32952880859375,
                  61.55893333624483
                ],
                [
                  79.36197280883789,
                  61.55893333624483
                ],
                [
                  79.36197280883789,
                  61.56481910315267
                ],
                [
                  79.32952880859375,
                  61.56481910315267
                ],
                [
                  79.32952880859375,
                  61.55893333624483
                ]
              ]
            ]
          }
        }
      ]
    }

    this.mapa.on('load',(event) => {
      Draw.set(geoJsonPolygonListBarranquilla);
      //this.mapa.removeSource()
      /* this.mapa.addSource('Barranquilla',{
        type:'geojson',
        data: geoJSON,


      }) */

       /* // Add a new layer to visualize the polygon.
      this.mapa.addLayer({
      'id': 'maine',
      'type': 'fill',
      'source': 'Barranquilla', // reference the data source
      'layout': {},
      'paint': {
      'fill-color': 'red', // blue color fill
      'fill-opacity': 0.5
      }
      });
      // Add a black outline around the polygon.
      this.mapa.addLayer({
      'id': 'outline',
      'type': 'line',
      'source': 'Barranquilla',
      'layout': {},
      'paint': {
      'line-color': 'blue',
      'line-width': 3
      }
      }); */

    });


  }

}
